---
- name: Update apt package manager cache
  ansible.builtin.apt:
    update_cache: true
  become: true
  tags:
    - apt

- name: Install apt packages
  ansible.builtin.apt:
    name: "{{ thibaut_apt_packages }}"
    state: latest
  become: true
  tags:
    - apt

- name: Remove useless packages from the cache
  ansible.builtin.apt:
    autoclean: true
  become: true
  tags:
    - apt
    - cleanup

- name: Remove dependencies that are no longer required
  ansible.builtin.apt:
    autoremove: true
  become: true
  tags:
    - apt
    - cleanup

- name: uv install latest Pythons
  ansible.builtin.command: >
    uv python install
    3.8
    3.9
    3.10
    3.11
    3.12
    3.13
  tags:
    - uv

- name: Uv install tools
  ansible.builtin.command: >
    uv tool install
    --python 3.12
    {{ item.name }}
    {% if item.with is defined %}
    {% for w in item.with %}--with {{ w }}{% endfor %}
    {% endif %}
  loop: "{{ thibaut_uv_tools }}"
  tags:
    - uv

- name: Uv upgrade tools
  ansible.builtin.command: >
    uv tool upgrade
    {{ item.name }}
    {% if item.with is defined %}
    {% for w in item.with %}--upgrade-package {{ w }}{% endfor %}
    {% endif %}
  loop: "{{ thibaut_uv_tools }}"
  tags:
    - uv

- name: Uv prune cache
  ansible.builtin.command: uv cache prune
  tags:
    - uv
    - cleanup